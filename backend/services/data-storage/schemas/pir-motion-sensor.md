# PIR Motion Sensor Schema

## Description
Schema for Passive Infrared (PIR) motion sensor data. This sensor detects motion through infrared radiation changes.

## InfluxDB Measurement
**Measurement Name:** `pir_motion`

## Tags (Indexed)
Tags are indexed and used for filtering queries.

| Tag Name      | Type   | Description                                      | Example              |
|---------------|--------|--------------------------------------------------|----------------------|
| device_id     | string | Unique identifier for the device                 | "pir-001"            |
| location      | string | Physical location of the sensor                  | "hallway-2"          |
| zone          | string | Zone or area within location                     | "corridor-a"         |
| sensor_type   | string | Type of PIR sensor                               | "HC-SR501"           |
| firmware_ver  | string | Firmware version of the device                   | "v2.1.0"             |

## Fields (Not Indexed)
Fields contain the actual measurement data.

| Field Name            | Type    | Unit        | Description                                    |
|-----------------------|---------|-------------|------------------------------------------------|
| motion_detected       | boolean | -           | Whether motion is detected (true/false)        |
| motion_start          | boolean | -           | Marks start of motion event                    |
| motion_end            | boolean | -           | Marks end of motion event                      |
| event_duration_ms     | integer | milliseconds| Duration of motion event                       |
| trigger_count         | integer | -           | Number of triggers in time window              |
| sensitivity_level     | integer | -           | Sensor sensitivity setting (1-10)              |
| detection_range_m     | float   | meters      | Detection range setting                        |
| ambient_temp_c        | float   | celsius     | Ambient temperature (if available)             |
| rssi                  | float   | dBm         | Signal strength indicator                      |
| battery_level         | float   | percentage  | Battery level if device is battery-powered     |

## Timestamp
- **Field:** Automatically generated by InfluxDB on data ingestion
- **Precision:** Nanoseconds
- **Timezone:** UTC

## Example Data Point (Line Protocol)
```
pir_motion,device_id=pir-001,location=hallway-2,zone=corridor-a,sensor_type=HC-SR501,firmware_ver=v2.1.0 motion_detected=true,motion_start=true,motion_end=false,event_duration_ms=0,trigger_count=1,sensitivity_level=7,detection_range_m=5.0,ambient_temp_c=22.5,rssi=-52.1,battery_level=92.0 1697472000000000000
```

## Example Data Point (JSON)
```json
{
  "measurement": "pir_motion",
  "tags": {
    "device_id": "pir-001",
    "location": "hallway-2",
    "zone": "corridor-a",
    "sensor_type": "HC-SR501",
    "firmware_ver": "v2.1.0"
  },
  "fields": {
    "motion_detected": true,
    "motion_start": true,
    "motion_end": false,
    "event_duration_ms": 0,
    "trigger_count": 1,
    "sensitivity_level": 7,
    "detection_range_m": 5.0,
    "ambient_temp_c": 22.5,
    "rssi": -52.1,
    "battery_level": 92.0
  },
  "timestamp": 1697472000000000000
}
```

## Indexing Strategy
- **Tags are automatically indexed** in InfluxDB for fast filtering
- **Device_id** is the primary filter for device-specific queries
- **Location and zone** enable spatial filtering
- **Sensor_type** allows filtering by hardware type
- **Firmware_ver** allows version-specific analysis

## Data Retention
- **Raw Data:** 30 days (configurable)
- **1-minute aggregates:** 90 days
- **1-hour aggregates:** 365 days
- **Daily aggregates:** 5 years

## Event Detection Pattern
For motion events, typically three data points are sent:
1. **Motion Start:** motion_detected=true, motion_start=true
2. **Motion Active:** motion_detected=true (periodic updates)
3. **Motion End:** motion_detected=false, motion_end=true, event_duration_ms=<duration>

## Common Queries
See `queries/pir-motion-examples.flux` for example queries.
